(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();const u="apiBase";let m=JSON.parse(localStorage.getItem("logs"))||[];function c(n,t="info"){const o=new Date().toISOString();m.push({timestamp:o,message:n,type:t}),localStorage.setItem("logs",JSON.stringify(m))}async function d(n,t,o=null){const e=localStorage.getItem(u)||"http://192.168.1.125:3000",s=showLoadingSpinner();try{if(n==="customers"){const a=await fetch(`${e}/customers`);if(!a.ok)throw new Error("Failed to fetch customers");const r=await a.json();t.renderCustomers(r,t)}else if(n==="sales"){const a=await fetch(`${e}/sales`);if(!a.ok)throw new Error("Failed to fetch sales");const r=await a.json();t.renderSales(r,t)}else if(n==="payments"){const a=await fetch(`${e}/payments`);if(!a.ok)throw new Error("Failed to fetch payments");const r=await a.json();t.renderPayments(r,t)}else if(n==="transactions"){const a=await fetch(`${e}/transactions`);if(!a.ok)throw new Error("Failed to fetch transactions");const r=await a.json();t.renderTransactions(r)}else if(n==="balances"){const a=await fetch(`${e}/balances`);if(!a.ok)throw new Error("Failed to fetch balances");const r=await a.json();t.renderBalances(r)}else if(n==="logs")t.renderLogs(m);else if(n==="dashboard"){const a=await fetch(`${e}/dashboard`);if(!a.ok)throw new Error("Failed to fetch dashboard");const r=await a.json();t.renderDashboard(r)}else if(n==="deleteCustomer"){const a=o,r=await fetch(`${e}/sales?customerName=${encodeURIComponent(a)}`),f=await fetch(`${e}/payments?customerName=${encodeURIComponent(a)}`);c(`Sales response: ${JSON.stringify(await r.json())}`),c(`Payments response: ${JSON.stringify(await f.json())}`);const b=(await r.json()).filter(y=>y["Customer Name"]===a),w=(await f.json()).filter(y=>y["Customer Name"]===a);if(b.length>0||w.length>0)throw new Error("Cannot delete customer with existing sales or payments");if(!(await fetch(`${e}/customers/${encodeURIComponent(a)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete customer");showToast("Customer deleted successfully"),await d("customers",t)}else if(n==="deleteSale"){if(!(await fetch(`${e}/sales/${o}`,{method:"DELETE"})).ok)throw new Error("Failed to delete sale");showToast("Sale deleted successfully"),await d("sales",t)}else if(n==="deletePayment"){if(!(await fetch(`${e}/payments/${o}`,{method:"DELETE"})).ok)throw new Error("Failed to delete payment");showToast("Payment deleted successfully"),await d("payments",t)}else n==="clearLogs"&&(m=[],localStorage.setItem("logs",JSON.stringify(m)),showToast("Logs cleared successfully"),await d("logs",t))}catch(a){c(`Error loading ${n}: ${a.message}`,"error"),showToast(`Error loading ${n}: ${a.message}`)}finally{hideLoadingSpinner(s)}}function l(n){const t=document.createElement("div");t.className="fixed bottom-4 right-4 bg-indigo-600 text-white px-4 py-2 rounded shadow-lg",t.textContent=n,document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function v(n,t){const o=document.getElementById("customers-table-body");o.innerHTML="",n.forEach(({name:e})=>{const s=document.createElement("tr");s.className="border-t",s.innerHTML=`
      <td class="px-4 py-2 truncate">${e}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-name="${e}">Delete</button>
      </td>
    `,o.appendChild(s),s.querySelector("button").addEventListener("click",()=>p(e,"customer",null,t))})}function E(n,t){const o=document.getElementById("sales-table-body");o.innerHTML="",n.forEach(e=>{const s=document.createElement("tr");s.className="border-t",s.innerHTML=`
      <td class="px-4 py-2 truncate">${e["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${e.Date}</td>
      <td class="px-4 py-2 truncate">${e.Quantity}</td>
      <td class="px-4 py-2 truncate">${e.Rate}</td>
      <td class="px-4 py-2 truncate">${e.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${e.id}">Delete</button>
      </td>
    `,o.appendChild(s),s.querySelector("button").addEventListener("click",()=>p(e["Customer Name"],"sale",e.id,t))})}function $(n,t){const o=document.getElementById("payments-table-body");o.innerHTML="",n.forEach(e=>{const s=document.createElement("tr");s.className="border-t",s.innerHTML=`
      <td class="px-4 py-2 truncate">${e["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${e.Date}</td>
      <td class="px-4 py-2 truncate">${e.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${e.id}">Delete</button>
      </td>
    `,o.appendChild(s),s.querySelector("button").addEventListener("click",()=>p(e["Customer Name"],"payment",e.id,t))})}function L(n){const t=document.getElementById("transactions-table-body");t.innerHTML="",n.forEach(o=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${o["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${o.Date}</td>
      <td class="px-4 py-2 truncate">${o.Type}</td>
      <td class="px-4 py-2 truncate">${o.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${o.id}">Delete</button>
      </td>
    `,t.appendChild(e)})}function S(n){const t=document.getElementById("balances-table-body");t.innerHTML="",n.forEach(o=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${o["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${o.Balance}</td>
    `,t.appendChild(e)})}function C(n){const t=document.getElementById("logs-table-body");t.innerHTML="",n.forEach(o=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${o.timestamp}</td>
      <td class="px-4 py-2 truncate">${o.message}</td>
    `,t.appendChild(e)}),document.getElementById("clear-logs")?.addEventListener("click",()=>p("all logs","logs",null,renderFunctions))}function I(n){document.getElementById("total-balance").textContent=n.totalBalance||0,new window.Chart(document.getElementById("balance-chart"),{type:"bar",data:{labels:n.balances.map(t=>t["Customer Name"]),datasets:[{label:"Balance",data:n.balances.map(t=>t.Balance),backgroundColor:"rgba(79, 70, 229, 0.2)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}let i=localStorage.getItem(u)||"http://192.168.1.125:3000";function T(n,t){if(c(`Setting up form listeners for tab: ${n}`),n==="customers"){const o=document.getElementById("customer-form");o?(o.reset(),o.addEventListener("submit",async e=>{e.preventDefault();const s=o.querySelector('button[type="submit"]');s.disabled=!0,s.textContent="Adding...",o.classList.add("opacity-50","pointer-events-none");const a=document.getElementById("customer-name")?.value.trim();if(c(`Submitting customer form: ${a}`),!a){c("Customer name is empty","error"),l("Customer Name is required"),s.disabled=!1,s.textContent="Add",o.classList.remove("opacity-50","pointer-events-none");return}try{const r=await fetch(`${i}/customers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"Customer Name":a})});if(!r.ok)throw new Error((await r.json()).error||"Failed to add customer");c(`Customer ${a} added successfully`),l("Customer added successfully"),o.reset(),await d("customers",t)}catch(r){c(`Error adding customer: ${r.message}`,"error"),l(`Error: ${r.message}`)}finally{s.disabled=!1,s.textContent="Add",o.classList.remove("opacity-50","pointer-events-none")}}),c("Customer form listener added")):c("Customer form not found","error")}if(n==="settings"){const o=document.getElementById("settings-form");o?(o.addEventListener("submit",async e=>{e.preventDefault();const s=o.querySelector('button[type="submit"]');s.disabled=!0,s.textContent="Saving...",o.classList.add("opacity-50","pointer-events-none");const a=o.querySelector('input[name="device-type"]:checked')?.value;if(c(`Submitting settings form: deviceType=${a}`),!a){l("Please select a device type"),s.disabled=!1,s.textContent="Save",o.classList.remove("opacity-50","pointer-events-none");return}try{const r=a==="mobile"?"http://localhost:3000":"http://192.168.1.125:3000";if(localStorage.setItem(u,r),localStorage.setItem("device-type",a),i=r,!(await fetch(`${i}/customers`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error("API unreachable");localStorage.setItem("apiValid",i),c(`Settings saved: deviceType=${a}, API=${i}`),l("Settings saved successfully"),o.reset(),await d("settings",t)}catch(r){c(`Error saving settings: ${r.message}`,"error"),l(`Error: ${r.message}`)}finally{s.disabled=!1,s.textContent="Save",o.classList.remove("opacity-50","pointer-events-none")}}),c("Settings form listener added")):c("Settings form not found","error")}}function x(n){const t=document.getElementById("device-form");t?(t.addEventListener("submit",async o=>{o.preventDefault();const e=t.querySelector('input[name="device-type"]:checked')?.value;if(c(`Submitting device form: deviceType=${e}`),!e){l("Please select a device type");return}try{const s=e==="mobile"?"http://localhost:3000":"http://192.168.1.125:3000";if(localStorage.setItem(u,s),localStorage.setItem("device-type",e),i=s,!(await fetch(`${i}/customers`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error("API unreachable");localStorage.setItem("apiValid",i),c(`Device type saved: ${e}, API=${i}`),document.getElementById("device-modal").classList.add("hidden"),await d("dashboard",n)}catch(s){c(`Error setting device type: ${s.message}`,"error"),l(`Error: ${s.message}`)}}),c("Device modal listener added")):c("Device form not found","error")}const g={renderCustomers:v,renderSales:E,renderPayments:$,renderTransactions:L,renderBalances:S,renderLogs:C,renderDashboard:I};function h(n,t){const o=document.querySelector("h2");o.textContent=n.charAt(0).toUpperCase()+n.slice(1);const e=document.getElementById("content");e.innerHTML=document.getElementById(`${n}-template`).innerHTML,d(n,t),T(n,t),n==="settings"&&x(t)}function p(n,t,o,e){const s=document.createElement("div");s.className="tk-modal",s.innerHTML=`
    <div class="tk-modal-content">
      <h2 class="text-lg font-semibold text-gray-900">Confirm Delete</h2>
      <p class="mt-2 text-gray-600">Are you sure you want to delete ${t} ${n}?</p>
      <div class="mt-4 flex justify-end space-x-2">
        <button id="cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-900 rounded hover:bg-gray-300">Cancel</button>
        <button id="confirm-btn" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Delete</button>
      </div>
    </div>
  `,document.body.appendChild(s),document.getElementById("cancel-btn").addEventListener("click",()=>s.remove()),document.getElementById("confirm-btn").addEventListener("click",async()=>{s.remove(),t==="customer"?await d("deleteCustomer",e,n):t==="sale"?await d("deleteSale",e,o):t==="payment"?await d("deletePayment",e,o):t==="logs"&&await d("clearLogs",e)})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("nav a").forEach(o=>{o.addEventListener("click",e=>{e.preventDefault();const s=o.getAttribute("data-tab");h(s,g)})}),localStorage.getItem("device-type")?h("dashboard",g):document.getElementById("device-modal").classList.remove("hidden")});
