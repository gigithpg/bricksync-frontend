(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const p="apiBase";let u=JSON.parse(localStorage.getItem("logs"))||[];function c(s,t="info"){const n=new Date().toISOString();u.push({timestamp:n,message:s,type:t}),localStorage.setItem("logs",JSON.stringify(u))}async function d(s,t,n=null){const e=localStorage.getItem(p)||"http://192.168.1.125:3000",a=showLoadingSpinner();try{if(s==="customers"){const o=await fetch(`${e}/customers`);if(!o.ok)throw new Error("Failed to fetch customers");const r=await o.json();t.renderCustomers(r,t)}else if(s==="sales"){const o=await fetch(`${e}/sales`);if(!o.ok)throw new Error("Failed to fetch sales");const r=await o.json();t.renderSales(r,t)}else if(s==="payments"){const o=await fetch(`${e}/payments`);if(!o.ok)throw new Error("Failed to fetch payments");const r=await o.json();t.renderPayments(r,t)}else if(s==="transactions"){const o=await fetch(`${e}/transactions`);if(!o.ok)throw new Error("Failed to fetch transactions");const r=await o.json();t.renderTransactions(r)}else if(s==="balances"){const o=await fetch(`${e}/balances`);if(!o.ok)throw new Error("Failed to fetch balances");const r=await o.json();t.renderBalances(r)}else if(s==="logs")t.renderLogs(u);else if(s==="dashboard"){const o=await fetch(`${e}/dashboard`);if(!o.ok)throw new Error("Failed to fetch dashboard");const r=await o.json();t.renderDashboard(r)}else if(s==="deleteCustomer"){const o=n,r=await fetch(`${e}/sales?customerName=${encodeURIComponent(o)}`),m=await fetch(`${e}/payments?customerName=${encodeURIComponent(o)}`);c(`Sales response: ${JSON.stringify(await r.json())}`),c(`Payments response: ${JSON.stringify(await m.json())}`);const w=(await r.json()).filter(y=>y["Customer Name"]===o),v=(await m.json()).filter(y=>y["Customer Name"]===o);if(w.length>0||v.length>0)throw new Error("Cannot delete customer with existing sales or payments");if(!(await fetch(`${e}/customers/${encodeURIComponent(o)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete customer");showToast("Customer deleted successfully"),await d("customers",t)}else if(s==="deleteSale"){if(!(await fetch(`${e}/sales/${n}`,{method:"DELETE"})).ok)throw new Error("Failed to delete sale");showToast("Sale deleted successfully"),await d("sales",t)}else if(s==="deletePayment"){if(!(await fetch(`${e}/payments/${n}`,{method:"DELETE"})).ok)throw new Error("Failed to delete payment");showToast("Payment deleted successfully"),await d("payments",t)}else s==="clearLogs"&&(u=[],localStorage.setItem("logs",JSON.stringify(u)),showToast("Logs cleared successfully"),await d("logs",t))}catch(o){c(`Error loading ${s}: ${o.message}`,"error"),showToast(`Error loading ${s}: ${o.message}`)}finally{hideLoadingSpinner(a)}}function l(s){const t=document.createElement("div");t.className="fixed bottom-4 right-4 bg-indigo-600 text-white px-4 py-2 rounded shadow-lg",t.textContent=s,document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function E(){const s=document.createElement("div");return s.className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center",s.innerHTML='<div class="animate-spin-slow h-8 w-8 border-4 border-indigo-600 rounded-full"></div>',document.body.appendChild(s),s}function $(s){s&&s.remove()}function L(s,t){const n=document.getElementById("customers-table-body");n.innerHTML="",s.forEach(({name:e})=>{const a=document.createElement("tr");a.className="border-t",a.innerHTML=`
      <td class="px-4 py-2 truncate">${e}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-name="${e}">Delete</button>
      </td>
    `,n.appendChild(a),a.querySelector("button").addEventListener("click",()=>f(e,"customer",null,t))})}function S(s,t){const n=document.getElementById("sales-table-body");n.innerHTML="",s.forEach(e=>{const a=document.createElement("tr");a.className="border-t",a.innerHTML=`
      <td class="px-4 py-2 truncate">${e["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${e.Date}</td>
      <td class="px-4 py-2 truncate">${e.Quantity}</td>
      <td class="px-4 py-2 truncate">${e.Rate}</td>
      <td class="px-4 py-2 truncate">${e.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${e.id}">Delete</button>
      </td>
    `,n.appendChild(a),a.querySelector("button").addEventListener("click",()=>f(e["Customer Name"],"sale",e.id,t))})}function C(s,t){const n=document.getElementById("payments-table-body");n.innerHTML="",s.forEach(e=>{const a=document.createElement("tr");a.className="border-t",a.innerHTML=`
      <td class="px-4 py-2 truncate">${e["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${e.Date}</td>
      <td class="px-4 py-2 truncate">${e.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${e.id}">Delete</button>
      </td>
    `,n.appendChild(a),a.querySelector("button").addEventListener("click",()=>f(e["Customer Name"],"payment",e.id,t))})}function I(s){const t=document.getElementById("transactions-table-body");t.innerHTML="",s.forEach(n=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${n["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${n.Date}</td>
      <td class="px-4 py-2 truncate">${n.Type}</td>
      <td class="px-4 py-2 truncate">${n.Amount}</td>
      <td class="px-4 py-2">
        <button class="btn bg-red-600 hover:bg-red-700" data-id="${n.id}">Delete</button>
      </td>
    `,t.appendChild(e)})}function x(s){const t=document.getElementById("balances-table-body");t.innerHTML="",s.forEach(n=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${n["Customer Name"]}</td>
      <td class="px-4 py-2 truncate">${n.Balance}</td>
    `,t.appendChild(e)})}function T(s){const t=document.getElementById("logs-table-body");t.innerHTML="",s.forEach(n=>{const e=document.createElement("tr");e.className="border-t",e.innerHTML=`
      <td class="px-4 py-2 truncate">${n.timestamp}</td>
      <td class="px-4 py-2 truncate">${n.message}</td>
    `,t.appendChild(e)}),document.getElementById("clear-logs")?.addEventListener("click",()=>f("all logs","logs",null,renderFunctions))}function N(s){document.getElementById("total-balance").textContent=s.totalBalance||0,new window.Chart(document.getElementById("balance-chart"),{type:"bar",data:{labels:s.balances.map(t=>t["Customer Name"]),datasets:[{label:"Balance",data:s.balances.map(t=>t.Balance),backgroundColor:"rgba(79, 70, 229, 0.2)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}let i=localStorage.getItem(p)||"http://192.168.1.125:3000";function B(s,t){if(c(`Setting up form listeners for tab: ${s}`),s==="customers"){const n=document.getElementById("customer-form");n?(n.reset(),n.addEventListener("submit",async e=>{e.preventDefault();const a=n.querySelector('button[type="submit"]');a.disabled=!0,a.textContent="Adding...",n.classList.add("opacity-50","pointer-events-none");const o=document.getElementById("customer-name")?.value.trim();if(c(`Submitting customer form: ${o}`),!o){c("Customer name is empty","error"),l("Customer Name is required"),a.disabled=!1,a.textContent="Add",n.classList.remove("opacity-50","pointer-events-none");return}try{const r=await fetch(`${i}/customers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"Customer Name":o})});if(!r.ok)throw new Error((await r.json()).error||"Failed to add customer");c(`Customer ${o} added successfully`),l("Customer added successfully"),n.reset(),await d("customers",t)}catch(r){c(`Error adding customer: ${r.message}`,"error"),l(`Error: ${r.message}`)}finally{a.disabled=!1,a.textContent="Add",n.classList.remove("opacity-50","pointer-events-none")}}),c("Customer form listener added")):c("Customer form not found","error")}if(s==="settings"){const n=document.getElementById("settings-form");n?(n.addEventListener("submit",async e=>{e.preventDefault();const a=n.querySelector('button[type="submit"]');a.disabled=!0,a.textContent="Saving...",n.classList.add("opacity-50","pointer-events-none");const o=n.querySelector('input[name="device-type"]:checked')?.value;if(c(`Submitting settings form: deviceType=${o}`),!o){l("Please select a device type"),a.disabled=!1,a.textContent="Save",n.classList.remove("opacity-50","pointer-events-none");return}try{const r=o==="mobile"?"http://localhost:3000":"http://192.168.1.125:3000";if(localStorage.setItem(p,r),localStorage.setItem("device-type",o),i=r,!(await fetch(`${i}/customers`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error("API unreachable");localStorage.setItem("apiValid",i),c(`Settings saved: deviceType=${o}, API=${i}`),l("Settings saved successfully"),n.reset(),await d("settings",t)}catch(r){c(`Error saving settings: ${r.message}`,"error"),l(`Error: ${r.message}`)}finally{a.disabled=!1,a.textContent="Save",n.classList.remove("opacity-50","pointer-events-none")}}),c("Settings form listener added")):c("Settings form not found","error")}}function b(s){const t=document.getElementById("device-form");t?(t.addEventListener("submit",async n=>{n.preventDefault();const e=t.querySelector('input[name="device-type"]:checked')?.value;if(c(`Submitting device form: deviceType=${e}`),!e){l("Please select a device type");return}const a=E();try{const o=e==="mobile"?"http://localhost:3000":"http://192.168.1.125:3000";localStorage.setItem(p,o),localStorage.setItem("device-type",e),i=o,c(`Attempting to validate API: ${i}/customers`);const r=await fetch(`${i}/customers`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!r.ok){const m=await r.text();throw new Error(`API unreachable: ${m}`)}localStorage.setItem("apiValid",i),c(`Device type saved: ${e}, API=${i}`),l("Device type saved successfully"),document.getElementById("device-modal").classList.add("hidden"),await d("dashboard",s)}catch(o){c(`Error setting device type: ${o.message}`,"error"),l(`Error: ${o.message}`)}finally{$(a)}}),c("Device modal listener added")):c("Device form not found","error")}const g={renderCustomers:L,renderSales:S,renderPayments:C,renderTransactions:I,renderBalances:x,renderLogs:T,renderDashboard:N};function h(s,t){const n=document.querySelector("h2");n.textContent=s.charAt(0).toUpperCase()+s.slice(1);const e=document.getElementById("content");e.innerHTML=document.getElementById(`${s}-template`).innerHTML,d(s,t),B(s,t),s==="settings"&&b(t)}function f(s,t,n,e){const a=document.createElement("div");a.className="tk-modal",a.innerHTML=`
    <div class="tk-modal-content">
      <h2 class="text-lg font-semibold text-gray-900">Confirm Delete</h2>
      <p class="mt-2 text-gray-600">Are you sure you want to delete ${t} ${s}?</p>
      <div class="mt-4 flex justify-end space-x-2">
        <button id="cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-900 rounded hover:bg-gray-300">Cancel</button>
        <button id="confirm-btn" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Delete</button>
      </div>
    </div>
  `,document.body.appendChild(a),document.getElementById("cancel-btn").addEventListener("click",()=>a.remove()),document.getElementById("confirm-btn").addEventListener("click",async()=>{a.remove(),t==="customer"?await d("deleteCustomer",e,s):t==="sale"?await d("deleteSale",e,n):t==="payment"?await d("deletePayment",e,n):t==="logs"&&await d("clearLogs",e)})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("nav a").forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();const a=n.getAttribute("data-tab");h(a,g)})}),localStorage.getItem("device-type")?h("dashboard",g):(document.getElementById("device-modal").classList.remove("hidden"),b(g))});
